/*!CK:1298597047!*//*1395637804,178154559*/

if (self.CavalryLogger) { CavalryLogger.start_js(["GK3bz"]); }

__d("MusicProviders",[],function(a,b,c,d,e,f){e.exports=a.MusicProviders={SPOTIFY:'open.spotify.com'};});
__d("SpotifyAjaxRequest",["ArbiterMixin","ErrorUtils","JSLogger","URI","copyProperties","emptyFunction","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=i.create('music_spotify'),o=function(){this._request=null;this._data={};this._option={timeout:30000,method:'GET'};this._timeout=null;};k(o,{LOAD_ERROR:'LOAD_ERROR',TIMEOUT_ERROR:'TIMEOUT_ERROR',PARSE_ERROR:'PARSE_ERROR',isSupported:function(){return window.XMLHttpRequest&&typeof XDomainRequest!=='undefined'||('withCredentials' in new XMLHttpRequest());}});k(o.prototype,g,{getDebugData:function(){return {uri:this._uri.toString(),data:this._data,options:this._option};},setData:function(p){this._data=p;return this;},setOption:function(p,q){this._option[p]=q;return this;},setURI:function(p){this._uri=j(p);return this;},makeRequestAndOpen:function(){var p=new XMLHttpRequest();if('withCredentials' in p){p.open(this._option.method,this._uri.toString(),true);}else if(typeof XDomainRequest!=='undefined'){p=new XDomainRequest();p.open(this._option.method,this._uri.toString());}else{n.error('not_supported',this.getDebugData());throw new Error('SpotifyAjaxRequest: not supported');}return p;},send:function(){if(this.inform('initial',this)!==false){this._uri.addQueryData(k({cors:''},this._data));this._request=this.makeRequestAndOpen();this._request.ontimeout=l;this._request.onprogress=l;this._request.onload=this._parseResult.bind(this);this._request.onerror=this._dispatchResult.bind(this,'error',{error:{type:o.LOAD_ERROR,message:'the request failed to load at: '+this._uri}});if(this._option.timeout>0)this._timeout=m(this._dispatchResult.bind(this,'timeout',{error:{type:o.TIMEOUT_ERROR,message:'a timeout occurred after '+this._option.timeout+'ms'}}),this._option.timeout);h.applyWithGuard(this._request.send,this._request,null,function(p){n.error('send_error',p);}.bind(this));}return this;},abort:function(){clearTimeout(this._timeout);try{this._request.abort();}catch(p){}this._request=null;this.inform('finish');return this;},_dispatchResult:function(p,q){clearTimeout(this._timeout);setTimeout(this.inform.bind(this,'finish',q),0);this.inform(p,q);},_parseResult:function(){var p,q,r,s;try{p=this._request.responseText||'';}catch(t){q=o.LOAD_ERROR;r='responseText not available - '+t.message;}if(!q)try{s=JSON.parse(p);}catch(t){q=o.PARSE_ERROR;r='exception parsing JSON - '+t.message;}if(!q&&!s){q=o.PARSE_ERROR;r='empty JSON';}if(q){this._dispatchResult('error',{error:{type:q,message:r}});}else this._dispatchResult(s.error?'error':'success',s);}});e.exports=o;});
__d("SpotifyRemote",["ArbiterMixin","AsyncRequest","Bootloader","Dialog","DOM","JSLogger","MusicConstants","MusicDiagnostics","MusicEvents","MusicProviders","Run","SpotifyAjaxRequest","URI","UserAgent","copyProperties","emptyFunction","ge","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y=l.create('music_spotify'),z=null;function aa(){}(function(){var ba=window.location.protocol==='https:';u(aa.prototype,g,{PROTOCOL_VERSIONS:[9],serial:1,manualPlay:false,showLoggingin:false,oauthTokenInvalid:false,config:{play_now_url:'/ajax/music/spotify_play_now.php?init_only',oauth_step:8,set_installed_url:'/ajax/music/spotify/installed.php',csrf_uri:'/ajax/music/spotify/set_csrf.php',fetch_oauth_url:'/ajax/music/spotify/auth.php?going_online',retryPeriod:3000,iframeUpdatePeriod:10000,iframeTryCycles:3,longPollPeriod:60000,optimisticPlayNowTime:1000,loggingInTimeout:15000,defaultTimeout:4000,pingWebHelperTimeout:m.CONFIG.PARTNER_TIMEOUT,expBackoffFactor:1.2,maxPollInterval:2200,apPollTimeout:8000},responseCallback:v,tokens:{spotify_csrf:'',spotify_oauth:'',last_timestamp:0},serverConfig:{url:window.location.protocol+'//'+((Math.random()*10000)|0)+'.spotilocal.com',webhelperPort:ba?4370:4380,path:'/',callbackParam:'callback',ops:{STATUS:'remote/status.json',RESUME:'remote/pause.json?pause=false',PAUSE:'remote/pause.json?pause=true',PLAY:'remote/play.json',VERSION:'service/version.json?service=remote',GET_IFRAME_RESPONSE:'csrf/getFbCsrfToken.html',LOGIN:'remote/login.json'}},STATES:{OFFLINE:'OFFLINE',RESIGNED:'RESIGNED',SEARCHING:'SEARCHING',AUTHENTICATING:'AUTHENTICATING',LOGGED_OUT_AND_WAITING:'LOGGED_OUT_AND_WAITING',FETCHING_OAUTH:'FETCHING_OAUTH',IFRAME_POLLING:'IFRAME_POLLING',RETRYING_TOKENS:'RETRYING_TOKENS',WAITING_TO_AUTH:'WAITING_TO_AUTH',LOGGING_IN:'LOGGING_IN',ONLINE:'ONLINE'},init:function(ca,da){this._iframeTryCount=0;this._providerArgs=da;this._switchToState(this.STATES.OFFLINE);ca&&this.setResponseCallback(ca);this.uri=new s(this.serverConfig.url||'');this.uri.setPort(this.serverConfig.webhelperPort);this.uri.setPath(this.serverConfig.path||'');if(da.fb_csrf)this.fb_csrf=da.fb_csrf;this._hasXDomainXHR=r.isSupported();},persistSearchingFor:function(ca){this._persistFor=ca;var da=this._persistentLoopTimer;this._resetPersistenceTimers();if(da&&this._persistFor)this._persistentLoopTimer=x(this._stopPersisting.bind(this),this._persistFor*1000);},serviceRunning:function(){switch(this.state){case this.STATES.LOGGED_OUT_AND_WAITING:case this.STATES.IFRAME_POLLING:case this.STATES.RETRYING_TOKENS:case this.STATES.FETCHING_OAUTH:case this.STATES.LOGGING_IN:case this.STATES.ONLINE:return true;default:return false;}},attemptGoOnline:function(ca){this.manualPlay=ca;if(!this._hasXDomainXHR&&ba||t.opera()){if(this.manualPlay)j.bootstrap('/ajax/music/spotify/unsupported_browser.php');return;}switch(this.state){case this.STATES.OFFLINE:case this.STATES.RESIGNED:this._switchToState(this.STATES.SEARCHING);this.responseCallback(m.DIAGNOSTIC_EVENT.SEARCHING);if(this._hasXDomainXHR){this._pingWebHelper();}else i.loadModules(["SpotifyJSONPRequest"],function(da){z=da;this._pingWebHelper();}.bind(this));break;case this.STATES.LOGGED_OUT_AND_WAITING:if(this.manualPlay){this._switchToState(this.STATES.LOGGING_IN);this._send(m.STATUS_CHANGE_OP.LOGIN);}}this.persistSearchingFor(this._persistFor);},reconnect:function(){if(this.state===this.STATES.IFRAME_POLLING){this._cleanupIframe();}else if(this.state===this.STATES.FETCHING_OAUTH){this.fetchedOauth=true;this.oauthTokenInvalid=false;}else{y.error('invalid_reconnect',this.state);return;}this._switchToState(this.STATES.RETRYING_TOKENS);this._send(m.STATUS_CHANGE_OP.STATUS);},setShowLoggingin:function(ca){this.showLoggingin=ca;},setTokens:function(ca,da){ca=ca||{};var ea=this.tokens.last_timestamp<da;if(ca.spotify_csrf&&(!this.tokens.spotify_csrf||ea))this.tokens.spotify_csrf=ca.spotify_csrf;if(ca.spotify_oauth&&(!this.tokens.spotify_oauth||ea))this.tokens.spotify_oauth=ca.spotify_oauth;if(ea&&(ca.spotify_csrf||ca.spotify_oauth))this.tokens.last_timestamp=da;},goOnline:function(){y.log('go_online',{uri:this.uri.toString(),from_state:this.state});this._switchToState(this.STATES.ONLINE);this._stopPersisting();this.oauthTokenInvalid=false;this._iframeTryCount=0;this.responseCallback(m.DIAGNOSTIC_EVENT.ONLINE);this._startPolling();new h(this.config.set_installed_url).setData({set:true,csrf:this.tokens.spotify_csrf}).send();},goOffline:function(){y.log('go_offline',{uri:this.uri.toString(),from_state:this.state});this._switchToState(this.STATES.OFFLINE);clearTimeout(this._authenticatingRetry);this._cleanupIframe();this._stopPersisting();this.oauthTokenInvalid=false;this.fetchedOauth=false;this._iframeTryCount=0;this.responseCallback(m.DIAGNOSTIC_EVENT.OFFLINE);},displayError:function(ca,da){y.error('display_error',{error_code:ca,extra_data:da});var ea=this._getDisplayErrorParams(ca,da);j.bootstrap('/ajax/music/play_error.php',ea);},_getDisplayErrorParams:function(ca,da){var ea={code:ca,provider:p.SPOTIFY};da=da||{};if(da.error_url)ea.url=da.error_url;if(da.song)ea.song=da.song;return ea;},launchPlayNowDialog:function(ca){if(this.state!==this.STATES.LOGGED_OUT_AND_WAITING&&this.serviceRunning())return;this._resetLaunchSubscription();var da=this._launchPlayNow.bind(this,ca);this.prePlayNowLaunchTimer=x(da,this.config.optimisticPlayNowTime);this.launchSubscription=this.subscribe([m.DIAGNOSTIC_EVENT.STATE_CHANGE,m.DIAGNOSTIC_EVENT.WRONG_VERSION],function(ea,fa){if(ea===m.DIAGNOSTIC_EVENT.WRONG_VERSION){this._resetLaunchSubscription();}else switch(fa.to){case this.STATES.OFFLINE:case this.STATES.RESIGNED:this._resetLaunchSubscription();da();break;case this.STATES.AUTHENTICATING:this._resetLaunchSubscription();setTimeout(n.userAction.bind(null,p.SPOTIFY,n.LAUNCH_NOT_NEEDED),0);break;}}.bind(this));this.attemptGoOnline(true);},send:function(ca,da){if(this.state===this.STATES.ONLINE){this.responseCallback(m.DIAGNOSTIC_EVENT.LOG_SEND_OP,{op:ca,params:da});this._send(ca,m.sanitizeForProviders(da));}else this.responseCallback(m.DIAGNOSTIC_EVENT.REQUEUE_OP,{op:ca,params:da});},setResponseCallback:function(ca){this.responseCallback=ca;},_send:function(ca,da){var ea=false;if(ca===m.OP.PLAY&&da){ea={uri:da.uri};if(da.playlist){ea.context=da.playlist;}else if(da.album){ea.context=da.album;}else if(da.song_list){var fa=da.song_list.indexOf(da.uri),ga=da.song_list.map(function(ka){return ka.replace(/.*\//,'');});ea.context='spotify:trackset:'+escape(da.title||'Facebook')+':'+ga.join(',');}if(da.offset){var ha=Math.floor(da.offset/60),ia=da.offset%60;ea.uri+='#'+ha+':'+ia;}if(da.request_id)ea.request_id=da.request_id;if(da.listen_with_friends)ea.listen_with_friends=da.listen_with_friends;}var ja=ea||da;if(ja&&ja.request_id)ja.request_id=ja.request_id+'';this._createOpRequest(ca,ja).send();setTimeout(n.sendUpdate.bind(null,p.SPOTIFY,ca,ja),0);},_launchPlayNow:function(ca){this._resetLaunchSubscription();var da=ca&&ca.context&&ca.context.button_id;j.bootstrap(this.config.play_now_url,ca,null,null,null,w(da));},_resetLaunchSubscription:function(){clearTimeout(this.prePlayNowLaunchTimer);if(this.launchSubscription){var ca=this.launchSubscription;this.launchSubscription=undefined;this.unsubscribe(ca);}},_pingWebHelper:function(){this._createOpRequest(m.OP.VERSION).send();},_stopPersisting:function(){this._persistFor=0;this._resetPersistenceTimers();return this;},_resetPersistenceTimers:function(){clearTimeout(this._persistentLoopTimer);clearTimeout(this._persistentLoopIterationTimer);this._persistentLoopTimer=null;this.loopIterationTime=1000;},_pingWebHelperModeResign:function(){if(this._persistFor){var ca=this.loopIterationTime*this.config.expBackoffFactor;if(ca<this.config.maxPollInterval)this.loopIterationTime=ca;this._persistentLoopIterationTimer=x(this.attemptGoOnline.bind(this,this.manualPlay),this.loopIterationTime);y.debug('persistence_connection_failed','retry in: '+(this.loopIterationTime/1000));this._switchToState(this.STATES.RESIGNED);}else this.goOffline();},_startPolling:function(){if(this.state!==this.STATES.ONLINE||!window.loaded)return false;q.onAfterLoad((function(){this._latestRequest=this._createOpRequest(m.STATUS_CHANGE_OP.STATUS,{returnon:'login,logout,play,error,ap',returnafter:this.config.longPollPeriod/1000});this._latestRequest.subscribe('finish',this._startPolling.bind(this));this._latestRequest.send();}).bind(this));},_pollForAP:function(){this._createOpRequest(m.STATUS_CHANGE_OP.STATUS,{returnon:'ap',returnafter:this.config.apPollTimeout/1000}).send();},_createOpRequest:function(ca,da){if(!this.serverConfig.ops[ca]){y.error('invalid_op',ca);return false;}var ea=this.config.defaultTimeout;if(da&&da.returnon){ea=0;}else if(this.state===this.STATES.SEARCHING){ea=this.config.pingWebHelperTimeout;}else if(this.state===this.STATES.LOGGING_IN)ea=this.config.loggingInTimeout;var fa=this._hasXDomainXHR?new r():new z();fa.setOption('callbackParam',this.serverConfig.callbackParam).setOption('timeout',ea).setData(u({csrf:this.tokens.spotify_csrf,oauth:this.tokens.spotify_oauth},(da||{}))).setURI(this.uri.toString()+this.serverConfig.ops[ca]);y.debug('create_op_request',fa.getDebugData());fa.subscribe('success',this._respondToSuccess.bind(this,ca));fa.subscribe('error',this._respondToError.bind(this,ca));fa.subscribe('timeout',this._respondToError.bind(this,ca));return fa;},_respondToSuccess:function(ca,da,ea){y.debug('respond_to_success',{op:ca,response_data:ea});if(ea.hasOwnProperty('online')&&!ea.online)if(this.state!=this.STATES.WAITING_TO_AUTH){this._switchToState(this.STATES.WAITING_TO_AUTH);this._pollForAP();return;}else{this.manualPlay&&this.displayError(4);this.goOffline();}switch(this.state){case this.STATES.SEARCHING:var fa=ea.client_version,ga=ea.version;if(this._isValidClient(fa,ga)){this._switchToState(this.STATES.AUTHENTICATING);this._send(m.STATUS_CHANGE_OP.STATUS);}else{y.error('connecting_schema_version_mismatch',{client_version:fa,protocol_version:ga});this.inform(m.DIAGNOSTIC_EVENT.WRONG_VERSION);if(this.manualPlay)j.bootstrap('/ajax/music/spotify/version_mismatch.php');this.goOffline();return;}break;case this.STATES.LOGGING_IN:case this.STATES.RETRYING_TOKENS:case this.STATES.AUTHENTICATING:this.goOnline();break;case this.STATES.WAITING_TO_AUTH:if(ea.online){this.goOnline();}else{this.manualPlay&&this.displayError(4);this.goOffline();}break;case this.STATES.RESIGNED:case this.STATES.OFFLINE:return;}ea=ea?this._convertURIFields(ea):{};this.error_count=0;this.responseCallback(ca,ea);},_respondToError:function(ca,da,ea){switch(this.state){case this.STATES.SEARCHING:y.debug('connect_miss',this.uri.toString());return;case this.STATES.RESIGNED:case this.STATES.OFFLINE:y.debug('offline_or_resigned',this.state);return;}if(ca===m.OP.VERSION){y.debug('stray_version');return;}var fa=v,ga=ea||{},ha=this._getError(ga.error.type);y.debug('respond_to_error',{op:ca,error_code:ha,payload:ga});switch(ha){case 'SERVICE_DEPENDENT_ERRORS':var ia=this._getError(ga.error.type,true),ja=this._getDisplayErrorParams(ia,ga);setTimeout(n.userAction.bind(null,p.SPOTIFY,m.DIAGNOSTIC_EVENT.SERVICE_ERROR,ja),0);if(m.STATUS_CHANGE_OP[ca]&&o.inform(m.DIAGNOSTIC_EVENT.SERVICE_ERROR,ja)!==false&&m.ERROR[ia]!=='AUDIO_AD_PLAYING')this.displayError(ia,ga);break;case 'PARSE_ERROR':case 'LOAD_ERROR':case 'TIMEOUT_ERROR':case 'SERVICE_NOT_RESPONDING':case 'UNKNOWN_SERVICE':case 'UNKNOWN_METHOD':case 'ERROR_PARSING_REQUEST':clearTimeout(this._authenticatingRetry);if(ha=='SERVICE_NOT_RESPONDING'&&this.state===this.STATES.AUTHENTICATING){fa=this._pingWebHelperModeResign;break;}fa=this._loadError;if(this.state===this.STATES.AUTHENTICATING||this.state===this.STATES.RETRYING_TOKENS){this._authenticatingRetry=x(this._send.bind(this,m.STATUS_CHANGE_OP.STATUS),this.config.retryPeriod);}else if(this.state===this.STATES.LOGGING_IN)this._authenticatingRetry=x(this._send.bind(this,m.STATUS_CHANGE_OP.LOGIN),this.config.retryPeriod);break;case 'INVALID_OAUTH_FOR_CURRENT_USER':case 'NO_USER_LOGGED_IN':if(this.state===this.STATES.ONLINE||this.state===this.STATES.WAITING_TO_AUTH){y.debug('user_logged_out');this.goOffline();this._switchToState(this.STATES.LOGGED_OUT_AND_WAITING);return;}else if(this.state===this.STATES.LOGGING_IN){this.oauthTokenInvalid=true;if(!this.fetchedOauth){this._switchToState(this.STATES.FETCHING_OAUTH);new h(this.config.fetch_oauth_url).send();return;}fa=this._authError;}else if(this.manualPlay){this._switchToState(this.STATES.LOGGING_IN);this._send(m.STATUS_CHANGE_OP.LOGIN);}else this._switchToState(this.STATES.LOGGED_OUT_AND_WAITING);break;case 'EXPIRED_OAUTH_TOKEN':case 'LOGIN_BAD_CREDENTIALS':this.oauthTokenInvalid=true;if(!this.fetchedOauth){this._switchToState(this.STATES.FETCHING_OAUTH);new h(this.config.fetch_oauth_url).send();return;}fa=this._authError;break;case 'OAUTH_TOKEN_NOT_VERIFIED':case 'TOKEN_VERIFICATION_TIMEOUT':if(this.state!=this.STATES.WAITING_TO_AUTH){this._switchToState(this.STATES.WAITING_TO_AUTH);this._pollForAP();return;}fa=this._authError;break;case 'INVALID_CSRF_TOKEN':case 'AUTH_FAILED':case 'TOKEN_VERIFICATION_DENIED_TOO_MANY_REQUESTS':fa=this._authError;break;default:y.error('bad_op',{op:ca,payload:ga});break;}fa.call(this,ca,ga);},_loadError:function(ca,da){y.debug('load_error',{op:ca,error_count:this.error_count+1,data:da});this.goOffline();},_authError:function(ca,da){y.error('auth_error',{op:ca,data:da,error_code:this._getError(da.error.type)});if(this.state===this.STATES.WAITING_TO_AUTH){this.manualPlay&&this.displayError(4);this.goOffline();return;}if(this.showLoggingin){this._launchPlayNow({step:10});this.showLoggingin=false;}this._cleanupIframe();if(this._iframeTryCount<=this.config.iframeTryCycles){this._switchToState(this.STATES.IFRAME_POLLING);this._makeIframePollRequest();this.responseCallback(m.DIAGNOSTIC_EVENT.IFRAME_POLLING);}else{if(this.manualPlay)j.bootstrap('/ajax/music/login_error.php');this.goOffline();}},_makeIframePollRequest:function(){var ca=s(window.location.href);if(ca.getSubdomain()=='our')ca=ca.setSubdomain('www');var da=window.location.protocol+'//'+ca.getDomain()+'/',ea=s(da+this.config.csrf_uri).setQueryData({fb_csrf:this.fb_csrf,refresh_token:this.oauthTokenInvalid}),fa=s(this.uri.toString()+this.serverConfig.ops.GET_IFRAME_RESPONSE).setQueryData({set_csrf_path:ea.toString(),cbust:this.serial++});this._cleanupIframe();this._iframe=k.create('iframe',{className:'hidden_elem',src:fa});y.debug('iframe_add',fa);document.body.appendChild(this._iframe);var ga=v;if(++this._iframeTryCount<this.config.iframeTryCycles){ga=function(){this._iframeTryCount>1&&y.debug('iframe_retry');this._makeIframePollRequest();};}else ga=function(){y.error('iframe_retry_exceeded');this._pingWebHelperModeResign();};this._iframePollTimeout=x(ga.bind(this),this.config.iframeUpdatePeriod);},_cleanupIframe:function(){this._iframePollTimeout&&clearTimeout(this._iframePollTimeout);this._iframe&&y.debug('iframe_remove',this._iframe.id);this._iframe&&k.remove(this._iframe);this._iframe=null;},_switchToState:function(ca){y.debug('switch_state',this.state+" => "+ca);setTimeout(n.stateChanged.bind(null,p.SPOTIFY,this.state,ca),0);this.inform(m.DIAGNOSTIC_EVENT.STATE_CHANGE,{from:this.state,to:ca});this.state=ca;},_convertURIFields:function(ca){if(!ca)return null;if(ca.track&&ca.track.track_resource){var da=ca.track;ca.track={uri:da.track_resource.location.og,name:da.track_resource.name};if(da.track_type)ca.track.track_type=da.track_type;if(da.artist_resource)ca.track.artist=da.artist_resource.name;if(da.album_resource)ca.track.album=da.album_resource.name;if(da.length){ca.playing_position=ca.playing_position?Math.floor(ca.playing_position):0;ca.expires_in=da.length-ca.playing_position;ca.expires_in=ca.expires_in<0?0:ca.expires_in;}}if(ca.context&&ca.context.context_resource&&ca.context.context_resource.location){var ea=ca.context;ca.context={uri:ea.context_resource.location.og,name:ea.context_resource.name};if(ea.creator)ca.context.creator=ea.creator.real_name;}for(var fa in ca)if(!m.ALLOWED_STATUS_PARAMS[fa])delete ca[fa];setTimeout(n.receiveUpdate.bind(null,p.SPOTIFY,ca),0);return ca;},_isValidClient:function(ca,da){var ea=this._providerArgs.blacklisted_versions,fa=this._providerArgs.minimum_version;return this.PROTOCOL_VERSIONS.indexOf(da)!==-1&&fa&&ea&&ca&&ea.indexOf(ca)===-1&&m.greaterOrEqualToMinimumVersion(ca,fa);},_getError:function(ca,da){if(!da&&!isNaN(parseFloat(ca)))if(ca>=4200&&ca<=4399)return this._errorMap['4200 - 4399'];return this._errorMap[ca];},_errorMap:{'4200 - 4399':'SERVICE_DEPENDENT_ERRORS',4201:1,4202:2,4203:3,4204:4,4205:5,4301:101,4302:102,4303:103,'4000 - 4099':'GENERAL_RPC_ERRORS',4001:'UNKNOWN_METHOD',4002:'ERROR_PARSING_REQUEST',4003:'UNKNOWN_SERVICE',4004:'SERVICE_NOT_RESPONDING','4100 - 4199':'RPC_AUTHENTICATION_ERRORS',4102:'LOGIN_BAD_CREDENTIALS',4103:'EXPIRED_OAUTH_TOKEN',4104:'OAUTH_TOKEN_NOT_VERIFIED',4105:'TOKEN_VERIFICATION_DENIED_TOO_MANY_REQUESTS',4106:'TOKEN_VERIFICATION_TIMEOUT',4107:'INVALID_CSRF_TOKEN',4108:'INVALID_OAUTH_FOR_CURRENT_USER',4109:'INVALID_CSRF_PATH',4110:'NO_USER_LOGGED_IN',LOAD_ERROR:'LOAD_ERROR',TIMEOUT_ERROR:'TIMEOUT_ERROR',PARSE_ERROR:'PARSE_ERROR'}});})();e.exports=a.SpotifyRemote||aa;});
__d("WebBridgeRemote",["Arbiter","ArbiterMixin","AsyncRequest","CSS","CurrentUser","Dialog","DOM","DTSG","Event","JSLogger","MusicConstants","MusicDiagnostics","ScubaSample","URI","UserAgent","copyProperties","cx","emptyFunction","ge","setTimeoutAcrossTransitions","swfobject2"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){var ba=p.create('music_web_bridge');function ca(da,ea,fa){this.responseCallback=da;this.provider=ea;if(!fa.external_player)return;this.externalPlayer=this._getExternalPlayer(fa.external_player);this.connectionName=t(this.externalPlayer).getDomain();this.state=ca.STATES.OFFLINE;this.lastSentMsg=null;this.wasOnline=false;this.connectionAttempts=0;this.lastStatusCheck=0;g.subscribe('MusicFlashBridge.'+this.provider+'.status',this.reportStatus.bind(this));g.subscribe('MusicFlashBridge.'+this.provider+'.initialized',function(){setTimeout(this._flashBridgeReady.bind(this),0);}.bind(this));u.osx()&&o.listen(window,'focus',this._onFocus.bind(this));u.osx()&&o.listen(window,'blur',this._onBlur.bind(this));}v(ca,{minFlashVersion:'10.3.181.34',flashBridgeSWF:'/music/flash/MusicFlashBridge.swf',configure:function(da){ba.debug('configure',da);ca.minFlashVersion=da.minFlashVersion;ca.flashBridgeSWF=da.flashBridgeSWF;},STATES:{OFFLINE:'OFFLINE',BRIDGE_WAITING:'BRIDGE_WAITING',BRIDGE_READY:'BRIDGE_READY',ONLINE:'ONLINE'},PLAY_NOW_URL:'/ajax/music/web_bridge_play_now.php?init_only',ERROR_DIALOG:'/ajax/music/play_error.php',TOS_URL:'/music/tos_launch_player.php',OPTIMISTIC_PLAYNOW_TIME:2000,UNLOAD_ON_BLUR_DELAY:3000,REMOTE_CONNECTION_INTERVAL:1500,REMOTE_CONNECTION_TIMEOUT_MANUAL:60,REMOTE_CONNECTION_TIMEOUT_AUTO:q.CONFIG.PARTNER_TIMEOUT/1000,REMOTE_CONNECTION_RETRY_TIMEOUT:4000,RECHECK_STATUS_ON_SEND_INTERVAL:10000,RECHECK_STATUS_SEND_TIMEOUT:500,hasMinFlashVersion:function(){if(!aa.hasFlashPlayerVersion(this.minFlashVersion)){ba.bump('flash_upgrade');new i().setURI('/ajax/flash_update_dialog.php').setMethod('GET').setReadOnly(true).send();return false;}return true;},getFlashMovieObject:function(da){if(document[da])return document[da];if(document.embeds&&document.embeds[da])return document.embeds[da];return y(da);},removeFlashMovieObject:function(da){if(document[da])document[da]=null;if(document.embeds&&document.embeds[da])document.embeds[da]=null;if(y(da))m.remove(da);}});v(ca.prototype,h,{responseCallback:x,flashBridge:null,persistFor:0,persistSearchingFor:function(da){this.connectionAttempts=0;this.persistFor=da;this.maxConnectAttempts=Math.floor((da*1000)/ca.REMOTE_CONNECTION_INTERVAL);if(this.state===ca.STATES.OFFLINE)this._initFlashBridge();},attemptGoOnline:function(da){var ea=da?ca.REMOTE_CONNECTION_TIMEOUT_MANUAL:ca.REMOTE_CONNECTION_TIMEOUT_AUTO;if(ea<this.persistFor)ea=this.persistFor;this.persistSearchingFor(ea);},goOffline:function(){ba.log('go_offline',{provider:this.provider,from_state:this.state});this._switchToState(ca.STATES.OFFLINE);this._removeFlashBridge();this._resetClientPoll();this.responseCallback(q.DIAGNOSTIC_EVENT.OFFLINE);},serviceRunning:function(){return this.state===ca.STATES.ONLINE;},reconnect:function(){},setTokens:function(da){},send:function(da,ea){if(this.state===ca.STATES.ONLINE){this._resetSendSubscription();var fa=function(){this._resetSendSubscription();this.responseCallback(q.DIAGNOSTIC_EVENT.LOG_SEND_OP,{op:da,params:ea});this._send(da,q.sanitizeForProviders(ea));}.bind(this);if(Date.now()-ca.RECHECK_STATUS_ON_SEND_INTERVAL>this.lastStatusCheck){this._sendTimer=z(fa,ca.RECHECK_STATUS_SEND_TIMEOUT);this._sendSubscription=this.subscribe(q.DIAGNOSTIC_EVENT.MISS,function(ga,ha){r.stateChanged(this.provider,null,null,q.DIAGNOSTIC_EVENT.INCORRECT_ONLINE_STATE);this._resetSendSubscription();this.goOffline();this.responseCallback(q.DIAGNOSTIC_EVENT.REQUEUE_OP,{op:da,params:ea});}.bind(this));this._send(q.STATUS_CHANGE_OP.STATUS,{});}else fa();}else this.responseCallback(q.DIAGNOSTIC_EVENT.REQUEUE_OP,{op:da,params:ea});},verifyOnlineState:function(da){if(this.state!==ca.STATES.ONLINE){da();}else{z(da,500);this._send(q.STATUS_CHANGE_OP.STATUS,{_never_queue:true});}},_resetSendSubscription:function(){this._sendTimer&&clearTimeout(this._sendTimer);this._sendSubscription&&this.unsubscribe(this._sendSubscription);this._sendSubscription=this._sendTimer=null;},_send:function(da,ea){switch(da){case q.OP.PLAY:case q.OP.RESUME:case q.OP.PAUSE:this.lastSentMsg={};v(this.lastSentMsg,ea);if(ea.radio_station||ea.album||ea.playlist||ea.musician){delete ea.song_list;}else if(!ea.song)ea.song=ea.uri;delete ea.uri;break;case q.STATUS_CHANGE_OP.STATUS:this.lastStatusCheck=Date.now();break;default:ba.error('invalid_op',{provider:this.provider,op:da});return;}if(this.flashBridge&&!this._unloadIfNeeded()){ba.debug('send',{provider:this.provider,op:da,params:ea});ba.rate('flash_movie_valid',(typeof this.flashBridge.send)==='function');this.flashBridge.send(da,ea);setTimeout(r.sendUpdate.bind(null,this.provider,da,ea),0);}},launch:function(da,ea,fa,ga,ha){var ia=this.provider.replace(/\.|-/g,'_'),ja=t(this.externalPlayer).addQueryData(ea),ka=ja;if(fa){ka=t(ca.TOS_URL).addQueryData({player_url:ja.toString(),url:da,perms:fa,get_dtsg:n.getToken()}).addQueryData(ha);}else{var la=new s('music_launch',null,{addBrowserFields:true,addPredictedGeographyFields:true,addUser:true});la.addNormal('uses_bridge','1');la.addNormal('provider',this.provider);la.addNormal('class','WebBridgeRemote');la.addNormal('new_install','0');la.addDenorm('url',da);la.flush();}window.open(ka,ia);setTimeout(r.sendUpdate.bind(null,this.provider,r.WINDOW_OPEN,ea),0);var ma={url:da,step:9};if(ga)ma=v(ma,ga);ba.debug('launch',{provider:this.provider,params:ma});this._launchPlayNow(ma);},launchPlayNowDialog:function(da){if(this.serviceRunning())return;this._resetLaunchSubscription();var ea=this._launchPlayNow.bind(this,da);this.prePlayNowLaunchTimer=z(ea,ca.OPTIMISTIC_PLAYNOW_TIME);this.launchSubscription=this.subscribe([q.DIAGNOSTIC_EVENT.MISS,q.DIAGNOSTIC_EVENT.STATE_CHANGE],function(fa,ga){if(fa===q.DIAGNOSTIC_EVENT.MISS){this._resetLaunchSubscription();ea();}else if(ga.to===ca.STATES.ONLINE){this._resetLaunchSubscription();setTimeout(r.userAction.bind(null,this.provider,r.LAUNCH_NOT_NEEDED),0);}}.bind(this));this.attemptGoOnline(true);},reportStatus:function(da,ea){var fa=ea.op,ga=ea.args;clearTimeout(this._pollTimeout);if(ga.error_code){setTimeout(r.userAction.bind(null,this.provider,q.DIAGNOSTIC_EVENT.SERVICE_ERROR,{code:ga.error_code}),0);var ha=q.ERROR[ga.error_code];switch(ha){case 'AUDIO_AD_PLAYING':ba.log('report_status_ad_playing',{error:ha,provider:this.provider,args:ga});break;default:var ia={code:ga.error_code,provider:this.provider};if(ga.song)ia.song=ga.song;if(ga.redirect_url)ia.url=ga.redirect_url;l.bootstrap(ca.ERROR_DIALOG,ia);ba.error('report_status_error',{error:ha,provider:this.provider,args:ga});return;}}if(ga.offline){this.goOffline();}else if(fa===q.DIAGNOSTIC_EVENT.MISS){this.inform(fa,ga);if(this.state!==ca.STATES.ONLINE&&this.state!==ca.STATES.OFFLINE){if(this.connectionAttempts<this.maxConnectAttempts){z(this._pollForClient.bind(this),ca.REMOTE_CONNECTION_INTERVAL);}else this.goOffline();}else if(this.state===ca.STATES.ONLINE){this.goOffline();if(this.lastSentMsg&&this.lastSentMsg.uri)this.responseCallback(q.DIAGNOSTIC_EVENT.RELAUNCH,{last_sent:this.lastSentMsg});return;}}else if(this.state===ca.STATES.BRIDGE_READY){this.wasOnline=true;this._switchToState(ca.STATES.ONLINE);this.responseCallback(q.DIAGNOSTIC_EVENT.ONLINE);}if(fa===q.STATUS_CHANGE_OP.STATUS)setTimeout(r.receiveUpdate.bind(null,this.provider,ga),0);if(ga.radio_station||ga.song){ga.track={};ga.track.uri=ga.radio_station||ga.song;ga.track.songuri=ga.song;}if(ga.radio_station){ga.context={name:ga.title,uri:ga.radio_station};}else if(ga.playlist){ga.context={name:ga.title,uri:ga.playlist};}else if(ga.album){ga.context={name:ga.title,uri:ga.album};}else if(ga.musician)ga.context={name:ga.title,uri:ga.musician};this.responseCallback.apply(this,[fa].concat(ga));},_onFocus:function(){clearTimeout(this._blurTimeout);if(!this.wasOnline)return;if(!this.flashBridge){this.persistSearchingFor(ca.REMOTE_CONNECTION_TIMEOUT_AUTO);}else{ba.rate('flash_movie_valid',(typeof this.flashBridge.activate)==='function');this.flashBridge.activate();}},_onBlur:function(){if(this.flashBridge){clearTimeout(this._blurTimeout);this._blurTimeout=setTimeout(function(){this._unloadIfNeeded();}.bind(this),ca.UNLOAD_ON_BLUR_DELAY);}},_unloadIfNeeded:function(){if(this.flashBridge)if(u.osx()){var da=(typeof this.flashBridge.shouldUnload==='function');ba.rate('flash_movie_valid',da);if(!da||this.flashBridge.shouldUnload()){this.goOffline();return true;}}return false;},_launchPlayNow:function(da){var ea=da&&da.context&&da.context.button_id;this._resetLaunchSubscription();l.bootstrap(ca.PLAY_NOW_URL,da,null,null,null,y(ea));},_resetLaunchSubscription:function(){clearTimeout(this.prePlayNowLaunchTimer);if(this.launchSubscription){var da=this.launchSubscription;this.launchSubscription=undefined;this.unsubscribe(da);}},_initFlashBridge:function(){this.flashBridge=ca.getFlashMovieObject(this.provider);if(!this.flashBridge){this._switchToState(ca.STATES.BRIDGE_WAITING);var da=this.provider+'_container';document.body.appendChild(m.create('div',{id:da}));aa.embedSWF(ca.flashBridgeSWF,da,'1px','1px',ca.minFlashVersion,null,{swf_id:this.provider,name:this.connectionName,user_id:k.getID(),domain:location.hostname},{allowscriptaccess:'always'},null,function(ea){ba.rate('flash_bridge_init',ea.success);ba.debug('flash_bridge_init',ea.success);this.flashBridge=ea.ref;if(this.flashBridge)j.addClass(this.flashBridge,"_2px");}.bind(this));}else this._flashBridgeReady();},_removeFlashBridge:function(){if(this.flashBridge){ba.debug('flash_bridge_unload',this.provider);var da=this.provider+'_container';aa.removeSWF(da);this.flashBridge=null;}},_switchToState:function(da){ba.debug('switch_state',this.provider+": "+this.state+" => "+da);setTimeout(r.stateChanged.bind(null,this.provider,this.state,da),0);this.inform(q.DIAGNOSTIC_EVENT.STATE_CHANGE,{from:this.state,to:da});this.state=da;},_flashBridgeReady:function(){ba.debug('flash_bridge_ready',{provider:this.provider,state:this.state});if(this.state!=ca.STATES.ONLINE){this._switchToState(ca.STATES.BRIDGE_READY);this._pollForClient();}},_resetClientPoll:function(){this.connectionAttempts=0;this.persistFor=0;clearTimeout(this._pollTimeout);},_pollForClient:function(){if(!this.flashBridge||((typeof this.flashBridge.send)!=='function')||this.state==ca.STATES.OFFLINE)return;this._send(q.STATUS_CHANGE_OP.STATUS,{});var da;if(++this.connectionAttempts<this.maxConnectAttempts){da=function(){if(this.state==ca.STATES.OFFLINE)return;ba.debug('poll_for_client',{provider:this.provider,connection_attempts:this.connectionAttempts});clearTimeout(this._pollTimeout);this._pollForClient();};}else da=function(){ba.debug('timeout_max_connection_attempts',this.provider);this.goOffline();};this._pollTimeout=z(da.bind(this),ca.REMOTE_CONNECTION_RETRY_TIMEOUT);},_getExternalPlayer:function(da){return da;}});e.exports=a.WebBridgeRemote||ca;});
__d("Music",["Arbiter","AsyncRequest","Bootloader","ChannelConstants","Dialog","JSLogger","MusicConstants","MusicDiagnostics","MusicEvents","MusicLogger","MusicProviders","Run","SpotifyRemote","WebBridgeRemote","areObjectsEqual","copyProperties","emptyFunction","ge","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=l.create('music'),aa={providers:{},queuedCommand:null,lastStatus:{},_searching:{},lastProviderPlaying:null,addRemoteModule:function(ba,ca){},init:function(ba,ca){z.debug('init',{music_providers:ba,reconnect:ca});for(var da in ba){this._setProviderConfig(da,v(this._getProviderConfig(da)||{offline:true},ba[da]));var ea=this._getProviderConfig(da),fa=this.getRemoteClass(da);fa.setTokens(ea.tokens,ea.last_used);ca&&fa.reconnect();}this.listenForScrobble();return this;},_getProviderConfig:function(ba){return this.providers[ba];},_getProviderConfigForLogging:function(ba){if(!this._hasProviderConfig(ba))return {};var ca=this._getProviderConfig(ba);return {offline:ca.offline,last_used:ca.last_used,instance:!!ca.instance};},_setProviderConfig:function(ba,ca){this.providers[ba]=ca;},_hasProviderConfig:function(ba){return !!this._getProviderConfig(ba);},persistSearchingFor:function(ba,ca){this._searching[ba]=true;var da;if(this._hasProviderConfig(ba))da=this.getRemoteClass(ba);da&&da.persistSearchingFor&&da.persistSearchingFor(ca);return this;},getRemoteClass:function(ba){if(!this._hasProviderConfig(ba)){z.error('provider_not_inited',ba);return null;}var ca=this._getProviderConfig(ba);if(!ca.instance){switch(ba){case q.SPOTIFY:var da=new s();da.init(this._receiveUpdate.bind(this,ba),ca);ca.instance=da;break;default:var ea=new t(this._receiveUpdate.bind(this,ba),ba,ca);ca.instance=ea;break;}if(!ca.instance)z.error('provider_module_not_loaded',ba);}return ca.instance;},listenForScrobble:function(){g.subscribe(j.getArbiterType('music_scrobbling'),function(ba,ca){if(ca.obj.provider_name){ca.obj.provider_data&&this.init(ca.obj.provider_data);this._resetQueuedCommand(ca.obj.provider_name);this.goOnline(ca.obj.provider_name);}}.bind(this));this.listenForScrobble=w;},goOnline:function(ba){var ca=(ba in this.providers);if(this._isOffline(ba)){var da=this.isManualPlay(ba),ea=ca&&this.getRemoteClass(ba);ea&&ea.attemptGoOnline(da);if(!this._searching[ba]&&da&&(!ea||!ea.serviceRunning())){this.persistSearchingFor(ba,60);this.launchPlayNowDialog(ba,this.queuedCommand.data);}}return this;},goOffline:function(ba,ca,da){if(this._hasProviderConfig(ba)){this._resetQueuedCommand(ba);this._searching[ba]=null;this.getRemoteClass(ba).goOffline();}return this;},allProvidersOffline:function(){for(var ba in this.providers)if(!this._isOffline(ba))return false;return true;},allProvidersPaused:function(){for(var ba in this.providers){var ca=this._getLastStatus(ba);if(ca&&ca.playing)return false;}return true;},playPauseSongList:function(ba,ca,da,ea,fa){v(fa||{},{song_list:da,title:ea||''});return this.playPauseSong(ba,ca,fa);},playPauseSong:function(ba,ca,da){if(!ba){ba=this.lastProviderPlaying;if(!ba)z.error('undefined_provider',ba);}z.debug('play_pause_song',{provider:ba,provider_config:this._getProviderConfigForLogging(ba),uri:ca,data:da});var ea=this._hasProviderConfig(ba)?this._getLastStatus(ba):{},fa=ea.track&&m.sameURLs(ca,ea.track.uri),ga=ea.context&&m.sameURLs(ca,ea.context.uri),ha=fa||ga;if(ea.playing&&ha){this.pause(ba,ca,da);}else if(ha){this.resume(ba,ca,da);}else this.playSong(ba,ca,da);return this._hasProviderConfig(ba)&&this.getRemoteClass(ba).serviceRunning();},pauseOtherProviders:function(ba){for(var ca in this.providers)if(ca!=ba&&!this._isOffline(ca))this.pause(ca);},launchProviderOrPlay:function(ba,ca,da,ea,fa,ga,ha,ia){if(fa){this._diagLogAction(fa,n.SWITCHED_PROVIDER);this.goOffline(fa);}if(!this._isOffline(ba)){this.playSong(ba,ca,da);var ja=k.getCurrent();ja&&ja.hide();}else if(ba==q.SPOTIFY){this.persistSearchingFor(ba,60);this._diagLogAction(ba,n.ATTEMPTING_LAUNCH,da);this.launchPlayNowDialog(ba,v({uri:ca},da),true);}else{!fa&&p.log(p.BUMP_KEY,{provider:ba,step:4,status:'okay'});var ka={};ka[ba]=ea;this.init(ka);this.launchBridgeProvider(ba,ca,da,ga,ha,ia);this.playSongSafeQueue(ba,ca,da);}},launchBridgeProvider:function(ba,ca,da,ea,fa,ga){if(ba==q.SPOTIFY)z.error('invalid_bridge_provider',ba);if(!this._isOffline(ba)){var ha=k.getCurrent();ha&&ha.hide();return;}this.persistSearchingFor(ba,60);var ia=m.sanitizeForProviders(da);this.getRemoteClass(ba).launch(ca,ia,ea,fa,ga);},launchPlayNowDialog:function(ba,ca,da){if(da)this.queuedCommand={provider:ba,op:m.OP.PLAY,data:ca};var ea=v({},ca),fa={url:ea.uri||ea.url,context:ea,listen_to:ea.listen_to||null,button_id:ea.button_id||null};delete fa.context.uri;delete fa.context.url;delete fa.context.listen_to;delete fa.context.button_id;if(this._hasProviderConfig(ba)){this.getRemoteClass(ba).launchPlayNowDialog(fa);}else{var ga;if(ba===q.SPOTIFY){ga='/ajax/music/spotify_play_now.php?init_only';}else ga='/ajax/music/web_bridge_play_now.php?init_only';k.bootstrap(ga,fa,null,null,null,x(fa.button_id));}},playSongSafeQueue:function(ba,ca,da){if(!this._isOffline(ba)||!this.queuedCommand||this.queuedCommand.provider!==ba){this.playSong(ba,ca,da);}else this._hasProviderConfig(ba)&&this.goOnline(ba);},playSong:function(ba,ca,da,ea){da=v(da||{},{uri:ca});if(ea&&ea.id&&!da.button_id)da.button_id=ea.id;this._sendOP(ba,m.OP.PLAY,da);},pause:function(ba,ca,da){da=v(da||{},{uri:ca||null});this._sendOP(ba,m.OP.PAUSE,da);},resume:function(ba,ca,da){da=v(da||{},{uri:ca});this._sendOP(ba,m.OP.RESUME,da);},reInform:function(ba){var ca=[];for(var da=0;da<ba.length;da++){var ea=ba[da];if(!this._isOffline(ea))if(ea==this.lastProviderPlaying){ca.push(ea);}else ca.unshift(ea);}for(var da=0;da<ca.length;da++){var ea=ca[da];z.debug('re_inform',ea);this._receive_STATUS_CHANGE_OP(ea,m.STATUS_CHANGE_OP.REINFORM,this.lastStatus[ea],{});}return this;},isManualPlay:function(ba){return !!(this.queuedCommand&&this.queuedCommand.provider===ba);},isPlaying:function(ba,ca){var da=this.getLastStatus(ba);return da.playing&&da.track&&(!ca||m.sameURLs(da.track.uri,ca));},getLastStatus:function(ba){return this._hasProviderConfig(ba)?this._getLastStatus(ba):{};},_resetQueuedCommand:function(ba){if(!ba||this.queuedCommand&&this.queuedCommand.provider==ba)this.queuedCommand=null;},_receiveUpdate:function(ba,ca,da){z.debug('receive_update',{provider:ba,op:ca,data:da,provider_config:this._getProviderConfigForLogging(ba)});if(da){da.provider=ba;}else da={provider:ba};var ea=w;if(m.DIAGNOSTIC_EVENT[ca]){ea=this._receiveDIAG_EVENT;}else if(m.STATUS_CHANGE_OP[ca]){ea=this._receive_STATUS_CHANGE_OP;}else !m.OP[ca];ea.call(this,ba,ca,da);},_receiveDIAG_EVENT:function(ba,ca,da){var ea=m.DIAGNOSTIC_EVENT;if(ca===ea.ONLINE){this._setOffline(ba,false);if(this.queuedCommand&&this.queuedCommand.provider==ba)r.onAfterLoad(this._replayQueuedCommand.bind(this,this.queuedCommand.provider,this.queuedCommand.op,this.queuedCommand.data));this._resetQueuedCommand();}else if(ca===ea.IFRAME_POLLING){this._setLastStatus(ba,{});}else if(ca===ea.RELAUNCH&&da.last_sent){this.launchPlayNowDialog(ba,da.last_sent,true);}else if(ca===ea.LOG_SEND_OP){this._logSendOp(ba,da.op,da.params,da.replay);}else if(ca===ea.REQUEUE_OP)this._queueAndGoOnline(ba,da.op,da.params);o.inform(ea[ca],da);if(ca===ea.OFFLINE){this._setOffline(ba,true);this._setLastStatus(ba,{});if(this.allProvidersOffline())o.inform(m.DIAGNOSTIC_EVENT.ALL_OFFLINE);}},_receive_STATUS_CHANGE_OP:function(ba,ca,da,ea){ea=ea||this._getLastStatus(ba);var fa;for(fa in ea)if(typeof da[fa]==='undefined')da[fa]=null;var ga,ha={};this._setLastStatus(ba,da);for(fa in da){ga=m.STATUS_CHANGE_EVENT[fa];if(ga)if(!ha[ga]&&!u(ea[fa],da[fa])){if(ca!==m.STATUS_CHANGE_OP.REINFORM)p.log(p.STATUS_EVENT_VIA,{op:ca,provider:ba,data:da});if(da.playing){if(this.lastProviderPlaying!=ba)this.pauseOtherProviders(ba);this.lastProviderPlaying=ba;}else if(this.allProvidersPaused())o.inform(m.DIAGNOSTIC_EVENT.ALL_PAUSED);o.inform(ga,da);ha[ga]=1;}}},_replayQueuedCommand:function(ba,ca,da){if(ca===m.OP.PLAY&&this.isPlaying(ba,da.uri))return;z.debug('replay_queued_command',ba+":"+ca);da.is_replayed_command=true;this._sendOP(ba,ca,da);},_sendOP:function(ba,ca,da){z.debug('send_op',{provider:ba,provider_config:this._getProviderConfigForLogging(ba),op:ca,data:da});if(!this._hasProviderConfig(ba)){this._queueAndGoOnline(ba,ca,da);}else this.getRemoteClass(ba).send(ca,da);},_logSendOp:function(ba,ca,da){var ea=ca===m.OP.PLAY;if(!da.is_replayed_command&&ea)this._diagLogAction(ba,n.LAUNCH_NOT_NEEDED);p.log(p.STATUS_EVENT_VIA,{op:ca,provider:ba,data:da});ea&&this._diagLogAction(ba,n.PLAY_SONG,da);},_queueAndGoOnline:function(ba,ca,da){z.debug('queue_and_go_online',{provider:ba,op:ca,data:da});if(!da._never_queue)this.queuedCommand={op:ca,data:da,provider:ba};if(ca===m.OP.PLAY)this._diagLogAction(ba,n.ATTEMPTING_LAUNCH,da);this.goOnline(ba);},_isOffline:function(ba){if(!this._hasProviderConfig(ba))return true;return this._getProviderConfig(ba).offline;},_setOffline:function(ba,ca){if(!this._hasProviderConfig(ba))return this;this._searching[ba]=null;this._getProviderConfig(ba).offline=ca;if(!ca&&!this.lastProviderPlaying){this.lastProviderPlaying=ba;}else if(ca&&this.lastProviderPlaying==ba){this.lastProviderPlaying=null;for(var da in this.providers)if(this.isPlaying(da)){this.lastProviderPlaying=da;break;}else if(!this._isOffline(da))this.lastProviderPlaying=da;}return this;},_getLastStatus:function(ba){if(!this._hasProviderConfig(ba))return {};return this.lastStatus[ba]||{};},_setLastStatus:function(ba,ca){if(!this._hasProviderConfig(ba))return this;this.lastStatus[ba]=ca;return this;},_diagLogAction:function(ba,ca,da){setTimeout(n.userAction.bind(null,ba,ca,da),0);}};e.exports=aa;a.Music=aa;});